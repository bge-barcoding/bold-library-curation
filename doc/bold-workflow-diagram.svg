<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1600" viewBox="0 0 1200 1600">
  <defs>
    <!-- Gradients for different phases -->
    <linearGradient id="phase1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#e8f4f8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d1e7f0;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="phase2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#fff2e8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ffe0cc;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="phase3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f0f8e8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e1f2cc;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="phase4" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f8e8f8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f0ccf0;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="phase5" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#e8f8f0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ccf2e1;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="phase6" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f8f0e8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f2e1cc;stop-opacity:1" />
    </linearGradient>
    
    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#333">BOLD Library Curation Workflow</text>
  <text x="600" y="55" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#666">Snakemake Pipeline Architecture</text>
  
  <!-- Phase 1: Data Preparation -->
  <rect x="50" y="80" width="1100" height="120" rx="10" fill="url(#phase1)" stroke="#4a90e2" stroke-width="2"/>
  <text x="70" y="105" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2c5282">Phase 1: Data Preparation &amp; Filtering</text>
  
  <!-- Input data -->
  <rect x="80" y="120" width="140" height="40" rx="5" fill="#ffffff" stroke="#4a90e2" stroke-width="1"/>
  <text x="150" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">BOLD TSV Input</text>
  
  <!-- Optional prescoring filter -->
  <rect x="280" y="120" width="180" height="40" rx="5" fill="#ffffff" stroke="#4a90e2" stroke-width="1" stroke-dasharray="5,5"/>
  <text x="370" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Prescoring Filter</text>
  <text x="370" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(Optional)</text>
  
  <!-- Phase 2: Database Setup -->
  <rect x="50" y="220" width="1100" height="180" rx="10" fill="url(#phase2)" stroke="#f6a623" stroke-width="2"/>
  <text x="70" y="245" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#8b4513">Phase 2: Database Creation &amp; Setup</text>
  
  <!-- Database creation steps -->  <rect x="80" y="265" width="120" height="40" rx="5" fill="#ffffff" stroke="#f6a623" stroke-width="1"/>
  <text x="140" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Create &amp; Load DB</text>
  
  <rect x="230" y="265" width="120" height="40" rx="5" fill="#ffffff" stroke="#f6a623" stroke-width="1"/>
  <text x="290" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Load Criteria</text>
  
  <rect x="380" y="265" width="120" height="40" rx="5" fill="#ffffff" stroke="#f6a623" stroke-width="1"/>
  <text x="440" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Apply Indexes</text>
  
  <rect x="530" y="265" width="120" height="40" rx="5" fill="#ffffff" stroke="#f6a623" stroke-width="1"/>
  <text x="590" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Load Taxonomy</text>
  
  <!-- Optional target list -->
  <rect x="680" y="265" width="140" height="40" rx="5" fill="#ffffff" stroke="#f6a623" stroke-width="1" stroke-dasharray="5,5"/>
  <text x="750" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Target List</text>
  <text x="750" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(Optional)</text>
  
  <!-- BAGS optimization -->
  <rect x="850" y="330" width="140" height="40" rx="5" fill="#ffffff" stroke="#f6a623" stroke-width="1"/>
  <text x="920" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">BAGS Optimization</text>
  
  <!-- Phase 3: Quality Assessment -->
  <rect x="50" y="420" width="1100" height="320" rx="10" fill="url(#phase3)" stroke="#7ed321" stroke-width="2"/>
  <text x="70" y="445" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#4a5d23">Phase 3: Quality Criteria Assessment</text>
  
  <!-- Grid of criteria assessments -->
  <g id="criteria-grid">
    <!-- Row 1 -->
    <rect x="80" y="465" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="135" y="487" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">COLLECTION_DATE</text>
    
    <rect x="210" y="465" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="265" y="487" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">COLLECTORS</text>
    
    <rect x="340" y="465" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="395" y="487" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">COUNTRY</text>
    
    <rect x="470" y="465" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="525" y="487" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">ID_METHOD</text>
    
    <rect x="600" y="465" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="655" y="487" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">IDENTIFIER</text>
    
    <rect x="730" y="465" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="785" y="487" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">INSTITUTION</text>
    
    <rect x="860" y="465" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="915" y="487" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">COORD</text>
    
    <rect x="990" y="465" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="1045" y="487" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">MUSEUM_ID</text>
    
    <!-- Row 2 -->
    <rect x="80" y="520" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="135" y="542" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">PUBLIC_VOUCHER</text>
    
    <rect x="210" y="520" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="265" y="542" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">SEQ_QUALITY</text>
    
    <rect x="340" y="520" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="395" y="542" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">SITE</text>
    
    <rect x="470" y="520" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="525" y="542" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">REGION</text>
    
    <rect x="600" y="520" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="655" y="542" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">SECTOR</text>
    
    <rect x="730" y="520" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="785" y="542" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">SPECIES_ID</text>
    
    <rect x="860" y="520" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="915" y="542" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">TYPE_SPECIMEN</text>
    
    <rect x="990" y="520" width="110" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="1045" y="542" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">HAS_IMAGE</text>
    
    <!-- Row 3 - Special analyses -->
    <rect x="200" y="580" width="130" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="265" y="602" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">HAPLOTYPE_ID</text>
    
    <rect x="360" y="580" width="130" height="35" rx="3" fill="#ffffff" stroke="#7ed321" stroke-width="1"/>
    <text x="425" y="602" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">OTU_CLUSTERING</text>
    
    <!-- BAGS assessment -->
    <rect x="520" y="650" width="160" height="50" rx="5" fill="#ffffff" stroke="#7ed321" stroke-width="2"/>
    <text x="600" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">BAGS Assessment</text>
    <text x="600" y="690" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(Species-level grading)</text>
  </g>
  
  <!-- Phase 4: Data Integration -->
  <rect x="50" y="760" width="1100" height="180" rx="10" fill="url(#phase5)" stroke="#50e3c2" stroke-width="2"/>
  <text x="70" y="785" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1a4d3a">Phase 4: Data Integration &amp; Ranking</text>
  
  <!-- Data integration steps -->
  <rect x="80" y="805" width="130" height="40" rx="5" fill="#ffffff" stroke="#50e3c2" stroke-width="1"/>
  <text x="145" y="830" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Concatenate Results</text>
  
  <rect x="240" y="805" width="130" height="40" rx="5" fill="#ffffff" stroke="#50e3c2" stroke-width="1"/>
  <text x="305" y="830" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Import to Database</text>
  
  <rect x="400" y="805" width="130" height="40" rx="5" fill="#ffffff" stroke="#50e3c2" stroke-width="1"/>
  <text x="465" y="830" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Calculate Rankings</text>
  
  <rect x="560" y="805" width="140" height="40" rx="5" fill="#ffffff" stroke="#50e3c2" stroke-width="1"/>
  <text x="630" y="830" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Select Representatives</text>
  
  <rect x="730" y="805" width="130" height="40" rx="5" fill="#ffffff" stroke="#50e3c2" stroke-width="1"/>
  <text x="795" y="830" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Manual Curation</text>
  
  <rect x="890" y="805" width="130" height="40" rx="5" fill="#ffffff" stroke="#50e3c2" stroke-width="1"/>
  <text x="955" y="830" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Generate Output</text>
  
  <!-- Subspecies inheritance -->
  <rect x="300" y="865" width="160" height="40" rx="5" fill="#ffffff" stroke="#50e3c2" stroke-width="1"/>
  <text x="380" y="890" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Inherit Subspecies BAGS</text>
  
  <!-- Phase 5: Output Generation -->
  <rect x="50" y="960" width="1100" height="120" rx="10" fill="url(#phase6)" stroke="#bd10e0" stroke-width="2"/>
  <text x="70" y="985" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#6b1c8a">Phase 5: Family Database Generation</text>
  
  <!-- Final outputs -->
  <rect x="80" y="1005" width="140" height="40" rx="5" fill="#ffffff" stroke="#bd10e0" stroke-width="1"/>
  <text x="150" y="1030" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Split Families</text>
  
  <rect x="250" y="1005" width="140" height="40" rx="5" fill="#ffffff" stroke="#bd10e0" stroke-width="1"/>
  <text x="320" y="1030" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Family Databases</text>
  
  <rect x="420" y="1005" width="140" height="40" rx="5" fill="#ffffff" stroke="#bd10e0" stroke-width="1"/>
  <text x="490" y="1030" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Final Summary</text>
  
  <!-- Output files -->
  <rect x="50" y="1100" width="1100" height="100" rx="10" fill="#f8f9fa" stroke="#e9ecef" stroke-width="2"/>
  <text x="70" y="1125" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#495057">Output Files</text>
  
  <text x="80" y="1150" font-family="Arial, sans-serif" font-size="12" fill="#333">📄 result_output.tsv - Final scored and ranked specimen data</text>
  <text x="80" y="1170" font-family="Arial, sans-serif" font-size="12" fill="#333">🗄️ family_databases/ - Individual SQLite databases per taxonomic family</text>
  <text x="80" y="1190" font-family="Arial, sans-serif" font-size="12" fill="#333">📊 pipeline_summary.txt - Comprehensive execution report</text>
  
  <!-- Process Flow Arrows -->
  <!-- Phase 1 to 2 -->
  <line x1="150" y1="200" x2="150" y2="220" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Database creation flow -->
  <line x1="200" y1="285" x2="230" y2="285" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="350" y1="285" x2="380" y2="285" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="285" x2="530" y2="285" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="650" y1="285" x2="680" y2="285" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- BAGS optimization flow -->
  <line x1="750" y1="305" x2="850" y2="330" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Phase 2 to 3 -->
  <line x1="590" y1="400" x2="590" y2="420" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- BAGS to integration -->
  <line x1="600" y1="740" x2="600" y2="760" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Integration flow -->
  <line x1="210" y1="825" x2="240" y2="825" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="370" y1="825" x2="400" y2="825" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="530" y1="825" x2="560" y2="825" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="700" y1="825" x2="730" y2="825" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="860" y1="825" x2="890" y2="825" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Phase 4 to 5 -->
  <line x1="600" y1="940" x2="600" y2="960" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Family processing flow -->
  <line x1="220" y1="1025" x2="250" y2="1025" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="390" y1="1025" x2="420" y2="1025" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Phase 5 to outputs -->
  <line x1="400" y1="1080" x2="400" y2="1100" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Conditional flows (dashed) -->
  <line x1="220" y1="140" x2="280" y2="140" stroke="#999" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  
  <!-- Legend -->
  <rect x="50" y="1220" width="1100" height="120" rx="10" fill="#f8f9fa" stroke="#e9ecef" stroke-width="2"/>
  <text x="70" y="1245" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#495057">Legend</text>
  
  <line x1="80" y1="1265" x2="110" y2="1265" stroke="#999" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="120" y="1270" font-family="Arial, sans-serif" font-size="12" fill="#333">Optional/Conditional Steps</text>
  
  <line x1="300" y1="1265" x2="330" y2="1265" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="340" y="1270" font-family="Arial, sans-serif" font-size="12" fill="#333">Required Process Flow</text>
  
  <rect x="80" y="1285" width="20" height="15" rx="3" fill="url(#phase3)" stroke="#7ed321" stroke-width="1"/>
  <text x="110" y="1297" font-family="Arial, sans-serif" font-size="12" fill="#333">Quality Assessment Rules</text>
  
  <rect x="300" y="1285" width="20" height="15" rx="3" fill="url(#phase5)" stroke="#50e3c2" stroke-width="1"/>
  <text x="330" y="1297" font-family="Arial, sans-serif" font-size="12" fill="#333">Data Integration Rules</text>
  
  <rect x="520" y="1285" width="20" height="15" rx="3" fill="url(#phase6)" stroke="#bd10e0" stroke-width="1"/>
  <text x="550" y="1297" font-family="Arial, sans-serif" font-size="12" fill="#333">Output Generation Rules</text>
  
  <!-- Key Features -->
  <text x="80" y="1325" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Key Features:</text>
  <text x="200" y="1325" font-family="Arial, sans-serif" font-size="11" fill="#333">• 16 Quality Criteria • BAGS Species Grading • OTU Clustering • Haplotype Analysis • Country Representatives • Family-level Splitting</text>
  
</svg>